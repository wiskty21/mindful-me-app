# MindfulMe - 動作テストマニュアル

このマニュアルでは、MindfulMe瞑想アプリの動作確認方法を説明します。

## 🎯 テスト目標

1. ローカル環境での基本動作確認
2. iOS Safari でのPWA動作確認
3. 実機での操作性・パフォーマンステスト
4. App Store申請前の最終チェック

## 📋 事前準備

### 必要な環境
- **Mac**: macOS 12以上（推奨）
- **Node.js**: 18以上
- **Go**: 1.21以上
- **iPhone/iPad**: iOS 14以上（実機テスト用）
- **MongoDB**: Atlas無料アカウント（後述）

### 準備手順

#### 1. MongoDB Atlas設定（必須）
```bash
# 1. https://cloud.mongodb.com/ でアカウント作成
# 2. 無料クラスター作成（M0 Sandbox）
# 3. Database Access でユーザー作成
# 4. Network Access で IP許可設定（0.0.0.0/0 または自分のIP）
# 5. Connect → Connect your application で接続文字列取得
```

**接続文字列例**:
```
mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/mindfulme?retryWrites=true&w=majority
```

#### 2. 環境変数設定
```bash
cd backend
cp .env.example .env

# .envファイルを編集
nano .env
```

**.envファイル設定内容**:
```env
PORT=8080
MONGODB_URI=mongodb+srv://your-username:your-password@cluster0.xxxxx.mongodb.net/mindfulme?retryWrites=true&w=majority
JWT_SECRET=mindfulme-jwt-secret-key-development-only-2025
ENVIRONMENT=development
```

## 🖥 ローカル環境テスト

### Phase 1: バックエンド動作確認

#### 1. サーバー起動
```bash
cd backend

# 依存関係インストール
go mod tidy

# サーバー起動
go run main.go
```

**期待する出力**:
```
[INFO] MongoDB接続成功
[INFO] サーバー起動: http://localhost:8080
```

#### 2. API動作テスト
```bash
# 別ターミナルで実行

# ヘルスチェック
curl http://localhost:8080/health

# 期待するレスポンス
{"status":"healthy","timestamp":"2025-07-20T...","database":"connected"}

# ユーザー登録テスト
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123","name":"Test User"}'

# 期待するレスポンス（JWTトークンが返される）
{"access_token":"eyJ...","refresh_token":"eyJ...","user":{...}}
```

#### 3. データベース接続確認
```bash
# MongoDBに接続してデータ確認
# MongoDB Compass または Atlas ダッシュボードで確認
# users コレクションにテストユーザーが作成されているか確認
```

### Phase 2: フロントエンド動作確認

#### 1. 開発サーバー起動
```bash
cd frontend

# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev
```

**期待する出力**:
```
  VITE v5.x.x  ready in xxx ms
  ➜  Local:   http://localhost:3000/
  ➜  Network: use --host to expose
```

#### 2. ブラウザでの基本動作確認
```
URL: http://localhost:3000
```

**テスト項目**:
- [ ] ログイン画面が表示される
- [ ] デモアカウントボタンが動作する
- [ ] 新規登録画面への遷移が動作する
- [ ] フォームバリデーションが動作する

#### 3. 認証フローテスト

**新規登録テスト**:
1. 新規登録画面へ移動
2. 以下の情報で登録:
   ```
   名前: Test User
   メール: test2@example.com
   パスワード: password123
   ```
3. 利用規約にチェック
4. 「アカウント作成」ボタンをクリック
5. ホーム画面へ自動遷移することを確認

**ログインテスト**:
1. ログアウト
2. ログイン画面へ移動
3. 作成したアカウントでログイン
4. ホーム画面へ遷移することを確認

### Phase 3: 機能動作テスト

#### 1. タイマー機能テスト

**基本タイマーテスト**:
1. ホーム画面の「5分」ボタンをクリック
2. タイマー画面へ遷移
3. 「瞑想を開始」ボタンをクリック
4. カウントダウンが開始されることを確認
5. 一時停止・再開ボタンの動作確認
6. 停止ボタンの動作確認

**カスタムタイマーテスト**:
1. タイマー画面でスライダーを操作
2. 異なる時間（例：3分）に設定
3. 呼吸瞑想タイプを選択
4. タイマーを開始し、呼吸ガイドの動作確認

#### 2. セッション記録テスト

**セッション完了テスト**:
1. 1分タイマーを設定
2. 最後まで実行して完了画面を表示
3. 気分選択（例：「穏やか」）
4. メモ入力（例：「集中できた」）
5. 「保存」ボタンをクリック
6. ホーム画面に戻ることを確認

**履歴確認テスト**:
1. 履歴画面へ移動
2. 保存したセッションが表示されることを確認
3. 統計情報が更新されることを確認
4. フィルター機能の動作確認

#### 3. プロフィール機能テスト

**設定変更テスト**:
1. プロフィール画面へ移動
2. デフォルト瞑想時間を変更（例：15分）
3. リマインダー時刻を設定
4. 設定が保存されることを確認

**ログアウトテスト**:
1. ログアウトボタンをクリック
2. ログイン画面へ遷移することを確認
3. 再ログイン後、設定が保持されることを確認

## 📱 iOS Safari 実機テスト

### Phase 4: iPhone/iPadでのPWAテスト

#### 1. 基本動作確認

**Safari アクセステスト**:
1. iPhoneのSafariで `http://localhost:3000` にアクセス
   ```
   注意: 同じWiFiネットワークに接続し、MacのIPアドレスを使用
   例: http://192.168.1.100:3000
   ```
2. ページが正常に表示されることを確認
3. Touch操作が正常に動作することを確認

#### 2. PWAインストールテスト

**ホーム画面追加テスト**:
1. Safari画面下部の共有ボタン（□↑）をタップ
2. 「ホーム画面に追加」を選択
3. アプリ名「MindfulMe」を確認
4. 「追加」をタップ
5. ホーム画面にアイコンが追加されることを確認

**PWA起動テスト**:
1. ホーム画面のMindfulMeアイコンをタップ
2. フルスクリーンで起動することを確認
3. URLバーが表示されないことを確認
4. ステータスバーが適切に表示されることを確認

#### 3. iOS特有の動作確認

**Safe Area対応テスト**:
- [ ] iPhone X以降でノッチ領域が適切に処理される
- [ ] ホームインジケータ領域が適切に確保される
- [ ] コンテンツが画面端で切れないことを確認

**タッチ操作テスト**:
- [ ] ボタンのタップ領域が十分（44pt以上）
- [ ] スクロールが滑らか
- [ ] 拡大・縮小が無効化されている
- [ ] テキスト入力時に画面がズームしない

**パフォーマンステスト**:
- [ ] アプリ起動が2秒以内
- [ ] 画面遷移が滑らか（60fps）
- [ ] タイマーの精度が正確
- [ ] メモリ使用量が適切

#### 4. オフライン動作テスト

**オフライン機能テスト**:
1. WiFiを切断
2. PWAが起動することを確認
3. 基本的なタイマー機能が動作することを確認
4. ログインが必要な機能で適切なエラー表示

**データ同期テスト**:
1. オフラインでセッションを実行
2. WiFi再接続
3. データが自動同期されることを確認

## 🔍 詳細検証テスト

### Phase 5: エッジケースのテスト

#### 1. エラーハンドリングテスト

**ネットワークエラー**:
- [ ] サーバー停止時の適切なエラー表示
- [ ] 接続タイムアウト時の動作
- [ ] API エラー時のユーザーフレンドリーな表示

**フォームバリデーション**:
- [ ] 不正なメールアドレス入力時のエラー
- [ ] パスワード要件不満時のエラー
- [ ] 必須項目未入力時のエラー

#### 2. セキュリティテスト

**認証セキュリティ**:
- [ ] ログアウト後のページアクセス制限
- [ ] JWT トークン期限切れ時の自動リフレッシュ
- [ ] 不正なトークンでのアクセス制限

#### 3. パフォーマンステスト

**メモリ使用量**:
```bash
# Safari開発者ツールで確認
# メモリ使用量が50MB以下であることを確認
```

**読み込み速度**:
- [ ] 初回読み込み: 3秒以内
- [ ] 画面遷移: 1秒以内
- [ ] API レスポンス: 2秒以内

## 📊 テスト結果記録

### テスト実行チェックリスト

```
□ Phase 1: バックエンド動作確認
  □ サーバー起動成功
  □ MongoDB接続成功
  □ API エンドポイント動作確認
  □ ユーザー登録・ログイン成功

□ Phase 2: フロントエンド基本動作
  □ 開発サーバー起動成功
  □ ログイン画面表示
  □ 認証フロー動作
  □ 画面遷移動作

□ Phase 3: 機能動作確認
  □ タイマー機能動作
  □ セッション記録・保存
  □ 履歴表示・統計更新
  □ プロフィール設定

□ Phase 4: iOS実機テスト
  □ Safari表示確認
  □ PWAインストール成功
  □ Safe Area対応確認
  □ タッチ操作確認

□ Phase 5: 詳細検証
  □ エラーハンドリング確認
  □ セキュリティ動作確認
  □ パフォーマンス測定
```

### 発見した問題の記録

```
問題 #1:
- 現象: [問題の説明]
- 再現手順: [手順]
- 期待動作: [期待される動作]
- 実際動作: [実際の動作]
- 優先度: [High/Medium/Low]
- 対応状況: [未対応/対応中/完了]

問題 #2:
...
```

## 🚀 本番リリース前チェック

### 最終確認項目

**コード品質**:
- [ ] TypeScript エラー 0件
- [ ] ESLint 警告 0件
- [ ] 本番ビルド成功
- [ ] PWA Lighthouse スコア 90以上

**App Store準備**:
- [ ] アプリアイコン各サイズ準備完了
- [ ] スクリーンショット撮影完了
- [ ] プライバシーポリシー・利用規約最終確認
- [ ] Apple Developer アカウント準備

**デプロイ準備**:
- [ ] 本番用MongoDB Atlas設定
- [ ] 本番用ドメイン取得・HTTPS設定
- [ ] 本番環境でのフルテスト実行

## 🛠 トラブルシューティング

### よくある問題と解決策

**MongoDB接続エラー**:
```
Error: MongoError: Authentication failed
→ .envファイルのMONGODB_URIを確認
→ Atlas でユーザー認証情報を確認
→ Network Access設定を確認
```

**フロントエンドビルドエラー**:
```
npm run build エラー
→ node_modules削除後、npm install
→ TypeScript型エラーを修正
→ vite.config.ts設定確認
```

**iOS Safari表示エラー**:
```
画面が正しく表示されない
→ Safe Area CSS設定確認
→ viewport meta tag確認
→ 16px フォントサイズ設定確認
```

**PWAインストールできない**:
```
「ホーム画面に追加」が表示されない
→ HTTPS接続確認（本番環境）
→ manifest.json設定確認
→ Service Worker登録確認
```

## 📞 サポート

問題が解決しない場合:
1. **GitHub Issues**: [リポジトリURL]/issues
2. **開発チーム**: dev@mindfulme.app
3. **ドキュメント**: README.md, app-store-preparation.md

---

**MindfulMe開発チーム**  
最終更新: 2025-07-20